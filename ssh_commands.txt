# Copy and paste these commands to fix opt.vivaindia.com

# Single command to fix everything:
ssh root@5.181.218.15 "cd /var/www/vhosts/opt.vivaindia.com/httpdocs/ && pm2 status && pm2 start ecosystem.config.js && pm2 status && curl -s http://localhost:8080/api/stores | head -100"

# If that doesn't work, try fresh start:
ssh root@5.181.218.15 "cd /var/www/vhosts/opt.vivaindia.com/httpdocs/ && pm2 delete all && pm2 start ecosystem.config.js && pm2 status"

# Add missing database columns after app is running:
ssh root@5.181.218.15 "mysql -h localhost -u ledbpt_optie -p'g79h94LAP' opticpro -e \"ALTER TABLE products ADD COLUMN IF NOT EXISTS barcode VARCHAR(100); ALTER TABLE patients ADD COLUMN IF NOT EXISTS emergency_contact VARCHAR(255); ALTER TABLE patients ADD COLUMN IF NOT EXISTS emergency_phone VARCHAR(20); ALTER TABLE store_inventory ADD COLUMN IF NOT EXISTS reserved_quantity INT DEFAULT 0; ALTER TABLE sales ADD COLUMN IF NOT EXISTS staff_id VARCHAR(36); ALTER TABLE customers ADD COLUMN IF NOT EXISTS city VARCHAR(100); ALTER TABLE customers ADD COLUMN IF NOT EXISTS state VARCHAR(50); ALTER TABLE customers ADD COLUMN IF NOT EXISTS zip_code VARCHAR(20); ALTER TABLE prescriptions ADD COLUMN IF NOT EXISTS store_id VARCHAR(36);\""

# Test if working:
curl https://opt.vivaindia.com