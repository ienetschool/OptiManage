# IMMEDIATE PRODUCTION SERVER RESTART
cd /var/www/vhosts/vivaindia.com/opt.vivaindia.sql

# 1. Kill existing server
pkill -f "tsx.*server/index.ts" 2>/dev/null || true

# 2. Start production server with API routes
NODE_ENV=production PORT=8080 FORCE_PRODUCTION=true DATABASE_URL="mysql://ledbpt_optie:g79h94LAP@localhost:3306/opticpro" nohup npx tsx server/index.ts > api-production.log 2>&1 &

# 3. Wait and test API endpoints
sleep 15
echo "=== Testing API endpoints ==="
curl -I http://localhost:8080/api/install/test-connection
curl -I http://localhost:8080/api/dashboard
curl -I http://localhost:8080/

# 4. Check port status
netstat -tlnp | grep :8080
echo "=== Production server PID ==="
ps aux | grep tsx | grep server/index.ts