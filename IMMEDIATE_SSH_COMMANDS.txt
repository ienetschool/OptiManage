# IMMEDIATE FIX for Git deployment permission error
# Run these commands in SSH terminal as root or with sudo

cd /var/www/vhosts/vivaindia.com/opt.vivaindia.sql

# 1. Fix ownership for the entire project directory
sudo chown -R $USER:$USER .
sudo chown -R $(whoami):$(whoami) .

# 2. Set proper permissions for all directories and files
sudo find . -type d -exec chmod 755 {} \;
sudo find . -type f -exec chmod 644 {} \;

# 3. Make sure server directory and subdirs are writable
sudo chmod -R 755 server/
sudo mkdir -p server/public/assets
sudo chmod -R 755 server/public/

# 4. Set Git-friendly permissions for deployment
sudo chown -R $(whoami):$(whoami) server/
sudo chmod -R 775 server/

# 5. Alternative: Set web server user ownership (if needed)
sudo chown -R apache:apache server/public/ 2>/dev/null || sudo chown -R www-data:www-data server/public/ 2>/dev/null

# 6. Verify the fix
ls -la server/
ls -la server/public/ 2>/dev/null || echo "server/public/ will be created by Git deployment"

# 7. Test permissions
touch server/test-permission.txt && rm server/test-permission.txt && echo "✅ Write permissions OK" || echo "❌ Still permission issues"

echo "Now retry the Git deployment from Plesk interface"